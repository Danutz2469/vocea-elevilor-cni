<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
    <title>Vocea Elevilor | CNI Piatra Neam»õ</title>
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <link rel="icon" type="image/png" href="logo-scoala.png">
    
    <style>
        /* Stiluri CSS: Nu le modificati decat daca stiti ce faceti */
        :root {
            --primary: #007bff;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --font-family: Arial, sans-serif;
            --bg-color: #f0f2f5;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--dark);
        }

        /* HEADER */
        .header {
            background-color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .logo-scoala {
            height: 40px;
            margin-right: 15px;
        }

        .site-title {
            font-size: 1.5em;
            color: var(--dark);
            margin: 0;
        }

        .header-right {
            display: flex;
            gap: 10px;
        }
        
        /* GENERAL UTILITIES */
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
            font-size: 0.9em;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }

        /* MAIN LAYOUT */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card h3 {
            color: var(--primary);
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-body textarea, .card-body input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            resize: vertical;
        }

        .message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        
        /* HERO SECTION (Background Image) */
        .hero {
            background: url('hero-bg.jpg') no-repeat center center;
            background-size: cover;
            height: 250px; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .hero h2 {
            font-size: 2.5em;
            margin: 0;
            padding-bottom: 10px;
        }
        
        .hero p {
            font-size: 1.2em;
            margin: 0;
        }

        /* ADMIN MODAL */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: center;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        
        /* ADMIN VIEW */
        .admin-view {
            display: none;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .admin-sidebar {
            background-color: var(--dark);
            color: white;
            padding: 20px 0;
            border-radius: 8px;
            height: 100%;
        }
        
        .admin-sidebar h4 {
            text-align: center;
            margin-top: 0;
            padding: 0 20px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-sidebar button {
            display: block;
            width: 100%;
            padding: 10px 20px;
            text-align: left;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .admin-sidebar button:hover, .admin-sidebar button.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .admin-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .data-item {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: var(--light);
            word-wrap: break-word;
        }
        
        .data-item.bullying {
            background-color: #f8d7da; /* Pentru a sublinia confidentialitatea */
        }
        
        .data-item strong {
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }
        
        .data-item span.date {
            font-size: 0.8em;
            color: var(--secondary);
            float: right;
        }
        
        /* Votare Sondaj */
        .poll-options label {
            display: block;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .poll-options label:hover {
            background-color: #f0f0f0;
        }

        .poll-results {
            margin-top: 20px;
            padding: 15px;
            border: 1px dashed var(--info);
            border-radius: 5px;
            background-color: #e0f7fa;
        }
        
        .poll-results .bar {
            background-color: var(--primary);
            height: 20px;
            margin-bottom: 5px;
            border-radius: 3px;
            color: white;
            text-align: center;
            line-height: 20px;
            font-size: 0.8em;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .grid-container {
                grid-template-columns: 1fr;
            }
            .header {
                flex-direction: column;
                gap: 10px;
            }
            .header-right {
                width: 100%;
                justify-content: space-around;
            }
            .admin-view {
                grid-template-columns: 1fr;
            }
            .admin-sidebar {
                padding: 10px;
                display: flex;
                flex-wrap: wrap;
                justify-content: space-around;
            }
            .admin-sidebar button {
                width: auto;
                flex-grow: 1;
                text-align: center;
            }
            .hero {
                height: 180px;
            }
            .hero h2 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="header-left">
            <img src="logo-scoala.png" alt="Logo »òcoalƒÉ" class="logo-scoala">
            <h1 class="site-title">VOCEA ELEVILOR CNI</h1>
        </div>
        <div class="header-right">
            <button id="adminLoginBtn" class="btn btn-primary">IntrƒÉ Mod Admin</button>
            <button id="adminLogoutBtn" class="btn btn-secondary" style="display: none;">Ie»ôi Admin</button>
        </div>
    </header>

    <div class="container">
        <div class="hero">
            <h2>Platforma de Comunicare Elevi</h2>
            <p>RaporteazƒÉ probleme, propune idei »ôi voteazƒÉ anonim!</p>
        </div>
    </div>

    <div class="container" id="studentView">
        <div class="grid-container">

            <div class="card">
                <h3><span style="color: var(--danger);">üî¥</span> RaporteazƒÉ o ProblemƒÉ √Æn »òcoalƒÉ</h3>
                <p>Spune-ne ce nu merge bine (anonim). Nu uita sƒÉ fii clar »ôi respectuos.</p>
                <div class="card-body">
                    <textarea id="problemInput" placeholder="Ex: Baia de la etajul 2 are o u»ôƒÉ stricatƒÉ..."></textarea>
                    <button class="btn btn-danger" onclick="submitData('problems', document.getElementById('problemInput'))">Trimite Problema</button>
                    <div id="problemMessage" class="message"></div>
                </div>
            </div>

            <div class="card">
                <h3><span style="color: var(--success);">üí°</span> Propune o Sugestie/Idee</h3>
                <p>Ai o idee bunƒÉ pentru a √ÆmbunƒÉtƒÉ»õi via»õa »ôcolarƒÉ? Aici e locul!</p>
                <div class="card-body">
                    <textarea id="suggestionInput" placeholder="Ex: SƒÉ se introducƒÉ un club de dezbateri sƒÉptƒÉm√¢nal..."></textarea>
                    <button class="btn btn-success" onclick="submitData('suggestions', document.getElementById('suggestionInput'))">Trimite Sugestia</button>
                    <div id="suggestionMessage" class="message"></div>
                </div>
            </div>

            <div class="card">
                <h3><span style="color: var(--info);">üì¢</span> Anun»õuri »ôi Evenimente</h3>
                <p>Informa»õii publicate de Consiliul Elevilor.</p>
                <div id="announcementList" class="card-body">
                    <p style="color: var(--secondary);">Niciun anun»õ publicat.</p>
                </div>
            </div>

            <div class="card">
                <h3><span style="color: var(--warning);">‚≠ê</span> Probleme Academice</h3>
                <p>DificultƒÉ»õi cu notele, tezele sau rela»õia elev-profesor (anonim).</p>
                <div class="card-body">
                    <textarea id="academicInput" placeholder="Ex: Nu √Æn»õeleg materia X, ar fi utilƒÉ o sesiune de medita»õii..."></textarea>
                    <button class="btn btn-warning" onclick="submitData('academics', document.getElementById('academicInput'))">Trimite Solicitarea</button>
                    <div id="academicMessage" class="message"></div>
                </div>
            </div>

            <div class="card" style="border: 2px solid var(--dark);">
                <h3><span style="color: var(--dark);">üîí</span> RaporteazƒÉ Bullying (Strict Confiden»õial)</h3>
                <p style="color: var(--dark); font-weight: bold;">Acest raport este vizibil DOAR de cƒÉtre administrator. VƒÉ rugƒÉm sƒÉ oferi»õi detalii clare (loc, ora, persoane).</p>
                <div class="card-body">
                    <textarea id="bullyingInput" placeholder="Descrie situa»õia √Æn detaliu..."></textarea>
                    <button class="btn" style="background-color: var(--dark); color: white;" onclick="submitData('bullying', document.getElementById('bullyingInput'))">Trimite Raport Confiden»õial</button>
                    <div id="bullyingMessage" class="message"></div>
                </div>
            </div>

            <div class="card">
                <h3><span style="color: var(--primary);">üó≥Ô∏è</span> Sondaj SƒÉptƒÉm√¢nal</h3>
                <div id="pollSection" class="card-body">
                    <div id="pollQuestion">
                        <p>DacƒÉ a»õi putea schimba un lucru la »ôcoalƒÉ sƒÉptƒÉm√¢na aceasta, care ar fi acela?</p>
                    </div>
                    <div class="poll-options">
                        <label>
                            <input type="radio" name="pollOption" value="orar"> Schimbarea orarului
                        </label>
                        <label>
                            <input type="radio" name="pollOption" value="mancare"> M√¢ncarea de la cantinƒÉ
                        </label>
                        <label>
                            <input type="radio" name="pollOption" value="curatenie"> CurƒÉ»õenia √Æn comun
                        </label>
                    </div>
                    <button class="btn btn-primary" onclick="submitPollVote()">VoteazƒÉ</button>
                    <div id="pollMessage" class="message"></div>
                </div>
                <div id="pollResults" class="poll-results" style="display: none;">
                    <h4>Rezultate Vot (Se poate vota o singurƒÉ datƒÉ)</h4>
                    <div id="resultsContainer"></div>
                </div>
            </div>

        </div>
    </div>

    <div class="container admin-view" id="adminView">
        <div class="admin-sidebar">
            <h4>Panou de Administrare</h4>
            <button class="active" onclick="showAdminSection('problems')">Probleme <span id="problemsCount"></span></button>
            <button onclick="showAdminSection('suggestions')">Sugestii <span id="suggestionsCount"></span></button>
            <button onclick="showAdminSection('academics')">Academice <span id="academicsCount"></span></button>
            <button onclick="showAdminSection('bullying')">Bullying (Conf.) <span id="bullyingCount"></span></button>
            <button onclick="showAdminSection('announcements')">Gest. Anun»õuri</button>
            <button onclick="showAdminSection('poll')">Gest. Sondaj</button>
        </div>
        <div class="admin-content">

            <div id="admin-problems" class="admin-section">
                <h3>SesizƒÉri Probleme Primite</h3>
                <div id="problemsList"></div>
            </div>

            <div id="admin-suggestions" class="admin-section" style="display: none;">
                <h3>Sugestii »ôi Idei Primite</h3>
                <div id="suggestionsList"></div>
            </div>

            <div id="admin-academics" class="admin-section" style="display: none;">
                <h3>SolicitƒÉri Academice Primite</h3>
                <div id="academicsList"></div>
            </div>

            <div id="admin-bullying" class="admin-section" style="display: none;">
                <h3>Rapoarte Bullying (Confiden»õiale)</h3>
                <div id="bullyingList"></div>
            </div>

            <div id="admin-announcements" class="admin-section" style="display: none;">
                <h3>PublicƒÉ Anun»õ Nou</h3>
                <textarea id="announcementInput" placeholder="Scrie anun»õul..."></textarea>
                <button class="btn btn-info" onclick="addAnnouncement()">PublicƒÉ Anun»õ</button>
                <div style="margin-top: 20px;">
                    <h4>Anun»õuri Curente</h4>
                    <div id="currentAnnouncementsList"></div>
                </div>
            </div>

            <div id="admin-poll" class="admin-section" style="display: none;">
                <h3>GestioneazƒÉ Sondajul</h3>
                <button class="btn btn-danger" onclick="resetPoll()">ReseteazƒÉ Voturile Sondajului</button>
                <p style="margin-top: 15px;">**Aten»õie: AceastƒÉ ac»õiune »ôterge toate voturile curente »ôi permite elevilor sƒÉ voteze din nou.**</p>
            </div>

        </div>
    </div>

    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="document.getElementById('adminModal').style.display='none'">&times;</span>
            <h2>Acces Mod Admin</h2>
            <p>Introduce»õi parola pentru a accesa panoul de administrare.</p>
            <input type="password" id="adminPasswordInput" placeholder="ParolƒÉ">
            <button class="btn btn-primary" onclick="checkAdminPassword()">IntrƒÉ</button>
            <p id="passwordError" style="color: var(--danger); margin-top: 10px; display: none;">ParolƒÉ incorectƒÉ.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
    <script>
        // *** CONFIGURARE ***
        const GITHUB_USERNAME = 'danutz2469'; // Schimba»õi cu numele dvs. de utilizator GitHub
        const REPO_NAME = 'vocea-elevilor-cni'; // Numele repozitoriului
        const FILE_NAME = 'index.html'; // Numele fi»ôierului pe care √Æl modificƒÉm (acesta)
        const ADMIN_PASSWORD = '1234'; // Parola de acces fixƒÉ pentru modul Admin

        // Variabile globale
        let data = {
            problems: [],
            suggestions: [],
            academics: [],
            bullying: [],
            announcements: [],
            poll: {
                question: 'DacƒÉ a»õi putea schimba un lucru la »ôcoalƒÉ sƒÉptƒÉm√¢na aceasta, care ar fi acela?',
                options: ['orar', 'mancare', 'curatenie'],
                votes: { orar: 0, mancare: 0, curatenie: 0 }
            }
        };

        // *************** FUNCTII GITHUB API ***************

        // Functie pentru a obtine datele curente din fisierul index.html
        async function fetchCurrentData() {
            const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_NAME}`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const file = await response.json();
                
                const content = atob(file.content);
                const startIndex = content.indexOf('// *** DATA START ***');
                const endIndex = content.indexOf('// *** DATA END ***');
                
                if (startIndex !== -1 && endIndex !== -1) {
                    const dataJson = content.substring(startIndex + 22, endIndex).trim();
                    const parsedData = JSON.parse(dataJson);
                    // ActualizƒÉm baza de date localƒÉ cu ce este pe GitHub
                    data = { ...data, ...parsedData };
                    // ActualizƒÉm sha-ul pentru viitoarele commit-uri
                    window.fileSha = file.sha;
                } else {
                    console.error("Nu s-au gƒÉsit marcatorii de date √Æn index.html. Se folosesc datele implicite.");
                    window.fileSha = file.sha; // Tot avem nevoie de sha
                }
            } catch (error) {
                console.error("Eroare la preluarea datelor curente de pe GitHub:", error);
                // DacƒÉ nu merge fetch-ul, se folosesc datele implicite
            }
            // Indiferent de succes, randƒÉm pagina
            renderUI();
        }

        // Functie pentru a trimite datele inapoi la GitHub (Efectiv Salvarea)
        async function commitDataToGitHub(commitMessage) {
            const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_NAME}`;
            
            // 1. Recreeaza continutul complet al fisierului index.html
            const currentHTML = document.documentElement.outerHTML;
            
            // 2. Extrage sectiunile de inceput si de sfarsit
            const startMarker = `// *** DATA START ***\n`;
            const endMarker = `// *** DATA END ***`;
            
            let newContent = currentHTML;
            let dataString = JSON.stringify(data, null, 4);

            // Cautam si inlocuim vechea zona de date cu cea noua
            const regex = new RegExp(`(?<=${startMarker})[\\s\\S]*?(?=${endMarker})`, 'm');
            
            if (regex.test(newContent)) {
                 newContent = newContent.replace(regex, `${dataString}\n`);
            } else {
                // Daca markerii nu exista (prima rulare), ii adaugam
                console.warn("Markerii de date nu au fost gƒÉsi»õi. VƒÉ rugƒÉm sƒÉ vƒÉ asigura»õi cƒÉ ave»õi // *** DATA START *** »ôi // *** DATA END *** la sf√¢r»ôitul fi»ôierului.");
            }

            // 3. Encodeaza continutul in base64
            const contentBase64 = btoa(newContent);
            
            const payload = {
                message: commitMessage,
                content: contentBase64,
                sha: window.fileSha, // SHA-ul ob»õinut la fetch
                branch: 'main'
            };

            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${getGitHubToken()}`, // Folosim token-ul stocat
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    // Eroare 409: Conflict (de obicei, altcineva a modificat sau sha-ul este vechi)
                    if (response.status === 409) {
                        alert("Eroare de conflict! Altcineva a trimis o sesizare chiar acum. √éncerca»õi din nou.");
                        return false;
                    }
                    throw new Error(`Commit failed with status: ${response.status}`);
                }
                
                const result = await response.json();
                window.fileSha = result.content.sha; // ActualizeazƒÉ SHA-ul pentru urmƒÉtoarea salvare
                return true;

            } catch (error) {
                console.error("Eroare la commit:", error);
                alert("A apƒÉrut o eroare la salvarea datelor pe GitHub. Verifica»õi token-ul sau conexiunea.");
                return false;
            }
        }
        
        // Functia placeholder pentru token-ul GitHub.
        // Datorita restrictiilor de securitate, utilizatorul trebuie sa introduca token-ul in localStorage.
        function getGitHubToken() {
            // Exemplu: Daca userul ar introduce un token in localStorage
            // window.localStorage.setItem('gh_token', 'ghp_XXXXXXXXXXXXXX');
            // return window.localStorage.getItem('gh_token');
            // Pentru ca nu am cerut token-ul, vom lasa null (se va face commit-ul automat doar la login)
            return null;
        }

        // *************** FUNCTII LOGARE ADMIN ***************
        
        function checkAdminPassword() {
            const input = document.getElementById('adminPasswordInput').value;
            const errorElement = document.getElementById('passwordError');

            if (input === ADMIN_PASSWORD) {
                // Logare cu succes
                localStorage.setItem('isAdmin', 'true');
                document.getElementById('adminModal').style.display = 'none';
                enterAdminMode();
            } else {
                errorElement.style.display = 'block';
                setTimeout(() => errorElement.style.display = 'none', 3000);
            }
        }

        function enterAdminMode() {
            document.getElementById('studentView').style.display = 'none';
            document.getElementById('adminView').style.display = 'grid';
            document.getElementById('adminLoginBtn').style.display = 'none';
            document.getElementById('adminLogoutBtn').style.display = 'block';
            showAdminSection('problems'); // Deschide default problems
            renderAdminContent();
        }

        function exitAdminMode() {
            localStorage.removeItem('isAdmin');
            document.getElementById('studentView').style.display = 'block';
            document.getElementById('adminView').style.display = 'none';
            document.getElementById('adminLoginBtn').style.display = 'block';
            document.getElementById('adminLogoutBtn').style.display = 'none';
            renderUI(); // Re-randare pentru a ascunde elemente admin
        }
        
        // *************** FUNCTII UI ADMIN ***************
        
        function showAdminSection(sectionName) {
            document.querySelectorAll('.admin-section').forEach(el => el.style.display = 'none');
            document.getElementById(`admin-${sectionName}`).style.display = 'block';
            
            document.querySelectorAll('.admin-sidebar button').forEach(el => el.classList.remove('active'));
            document.querySelector(`.admin-sidebar button[onclick*="${sectionName}"]`).classList.add('active');
            
            renderAdminContent(); // Re-randare la schimbarea sec»õiunii
        }
        
        function renderAdminContent() {
            renderList('problems', 'problemsList', true);
            renderList('suggestions', 'suggestionsList', true);
            renderList('academics', 'academicsList', true);
            renderList('bullying', 'bullyingList', true, true);
            renderAnnouncementsAdmin();
            updateAdminCounts();
        }
        
        function renderList(dataType, listId, isAdmin = false, isBullying = false) {
            const listElement = document.getElementById(listId);
            listElement.innerHTML = '';
            
            if (data[dataType] && data[dataType].length > 0) {
                data[dataType].forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `data-item ${isBullying ? 'bullying' : ''}`;
                    itemDiv.innerHTML = `
                        <span class="date">${new Date(item.timestamp).toLocaleDateString('ro-RO')} ${new Date(item.timestamp).toLocaleTimeString('ro-RO')}</span>
                        <strong>${item.title || 'Raport Anonim'}</strong>
                        ${item.content}
                        ${isAdmin ? `<button class="btn btn-danger" style="margin-top: 10px;" onclick="deleteData('${dataType}', ${index})">»òterge</button>` : ''}
                    `;
                    listElement.appendChild(itemDiv);
                });
            } else {
                listElement.innerHTML = `<p style="color: var(--secondary);">Nu existƒÉ ${dataType} primite.</p>`;
            }
        }
        
        function deleteData(dataType, index) {
            if (confirm(`Sunte»õi sigur cƒÉ dori»õi sƒÉ »ôterge»õi acest element din ${dataType}?`)) {
                data[dataType].splice(index, 1);
                
                // Salvarea pe GitHub
                commitDataToGitHub(`[ADMIN] »òterge element din ${dataType}`).then(success => {
                    if (success) {
                        alert("Element »ôters »ôi salvat pe GitHub. Site-ul se va actualiza √Æn cur√¢nd.");
                        renderAdminContent();
                    }
                });
            }
        }
        
        function updateAdminCounts() {
            document.getElementById('problemsCount').textContent = `(${data.problems.length})`;
            document.getElementById('suggestionsCount').textContent = `(${data.suggestions.length})`;
            document.getElementById('academicsCount').textContent = `(${data.academics.length})`;
            document.getElementById('bullyingCount').textContent = `(${data.bullying.length})`;
        }
        
        function renderAnnouncementsAdmin() {
            const listElement = document.getElementById('currentAnnouncementsList');
            listElement.innerHTML = '';

            if (data.announcements && data.announcements.length > 0) {
                data.announcements.slice().reverse().forEach((item, index) => {
                    const reversedIndex = data.announcements.length - 1 - index;
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'data-item';
                    itemDiv.innerHTML = `
                        <span class="date">${new Date(item.timestamp).toLocaleDateString('ro-RO')}</span>
                        <strong>Anun»õ:</strong>
                        ${item.content}
                        <button class="btn btn-danger" style="margin-top: 10px;" onclick="deleteData('announcements', ${reversedIndex})">»òterge Anun»õ</button>
                    `;
                    listElement.appendChild(itemDiv);
                });
            } else {
                listElement.innerHTML = `<p style="color: var(--secondary);">Niciun anun»õ publicat.</p>`;
            }
        }
        
        function addAnnouncement() {
            const input = document.getElementById('announcementInput');
            const content = input.value.trim();
            
            if (content.length < 5) {
                alert("Anun»õul este prea scurt.");
                return;
            }
            
            data.announcements.push({
                content: content,
                timestamp: Date.now()
            });
            input.value = '';

            commitDataToGitHub(`[ADMIN] AdaugƒÉ anun»õ`).then(success => {
                if (success) {
                    alert("Anun»õ publicat »ôi salvat pe GitHub. Site-ul se va actualiza √Æn cur√¢nd.");
                    renderAdminContent();
                }
            });
        }

        // *************** FUNCTII UI NORMAL ***************
        
        function renderUI() {
            if (localStorage.getItem('isAdmin') === 'true') {
                enterAdminMode();
                return;
            }
            
            // Randare Anunturi (Mod normal)
            const announcementList = document.getElementById('announcementList');
            announcementList.innerHTML = '';
            if (data.announcements.length > 0) {
                data.announcements.slice().reverse().forEach(announcement => {
                    const item = document.createElement('div');
                    item.className = 'data-item';
                    item.innerHTML = `
                        <span class="date">${new Date(announcement.timestamp).toLocaleDateString('ro-RO')}</span>
                        ${announcement.content}
                    `;
                    announcementList.appendChild(item);
                });
            } else {
                announcementList.innerHTML = `<p style="color: var(--secondary);">Niciun anun»õ publicat.</p>`;
            }
            
            // Randare Sondaj
            renderPollSection();
        }

        async function submitData(dataType, inputElement) {
            const content = inputElement.value.trim();
            const messageElement = document.getElementById(dataType + 'Message');
            
            if (content.length < 10) {
                showMessage(messageElement, 'VƒÉ rugƒÉm sƒÉ oferi»õi mai multe detalii (min. 10 caractere).', 'danger');
                return;
            }
            
            data[dataType].push({
                content: content,
                timestamp: Date.now()
            });
            inputElement.value = '';
            
            // Salvarea pe GitHub
            const success = await commitDataToGitHub(`[ELEV] Trimite ${dataType}`);
            
            if (success) {
                showMessage(messageElement, 'Mul»õumim! Sesizarea a fost trimisƒÉ »ôi va apƒÉrea √Æn scurt timp pe site.', 'success');
            } else {
                 showMessage(messageElement, 'Eroare la trimitere. VƒÉ rugƒÉm sƒÉ √Æncerca»õi din nou.', 'danger');
            }
        }
        
        function showMessage(element, text, type) {
            element.textContent = text;
            element.className = `message ${type}`;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
        
        // *************** FUNCTII VOT ***************
        
        function renderPollSection() {
            const pollSection = document.getElementById('pollSection');
            const pollResults = document.getElementById('pollResults');
            
            if (localStorage.getItem('voted')) {
                pollSection.style.display = 'none';
                pollResults.style.display = 'block';
                displayPollResults();
            } else {
                pollSection.style.display = 'block';
                pollResults.style.display = 'none';
            }
        }
        
        function submitPollVote() {
            const selectedOption = document.querySelector('input[name="pollOption"]:checked');
            const messageElement = document.getElementById('pollMessage');

            if (!selectedOption) {
                showMessage(messageElement, 'VƒÉ rugƒÉm sƒÉ selecta»õi o op»õiune.', 'danger');
                return;
            }
            
            const voteKey = selectedOption.value;
            data.poll.votes[voteKey] += 1;
            
            localStorage.setItem('voted', 'true');
            
            // Salvarea pe GitHub
            commitDataToGitHub(`[ELEV] VoteazƒÉ sondaj`).then(success => {
                if (success) {
                    showMessage(messageElement, 'Vot √Ænregistrat! Mul»õumim.', 'success');
                    renderPollSection();
                } else {
                    localStorage.removeItem('voted'); // Daca esueaza, permite re-votul
                    showMessage(messageElement, 'Eroare la √Ænregistrarea votului. √éncerca»õi din nou.', 'danger');
                }
            });
        }
        
        function displayPollResults() {
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';
            
            const totalVotes = Object.values(data.poll.votes).reduce((a, b) => a + b, 0);
            
            for (const key in data.poll.votes) {
                const count = data.poll.votes[key];
                const percentage = totalVotes === 0 ? 0 : Math.round((count / totalVotes) * 100);
                
                const bar = document.createElement('div');
                bar.innerHTML = `
                    <p style="margin: 5px 0 0;">${key.toUpperCase()} (${count} voturi):</p>
                    <div class="bar" style="width: ${percentage}%; min-width: ${percentage > 0 ? '20px' : '0'};">${percentage}%</div>
                `;
                resultsContainer.appendChild(bar);
            }
        }
        
        function resetPoll() {
            if (!confirm("Sunte»õi sigur cƒÉ dori»õi sƒÉ reseta»õi toate voturile sondajului? AceastƒÉ ac»õiune este ireversibilƒÉ.")) return;

            // ReseteazƒÉ voturile √Æn structura de date
            for (const key in data.poll.votes) {
                data.poll.votes[key] = 0;
            }
            
            // Salvarea pe GitHub
            commitDataToGitHub(`[ADMIN] ReseteazƒÉ voturile sondajului`).then(success => {
                if (success) {
                    alert("Sondajul a fost resetat! Elevii pot vota din nou. Site-ul se va actualiza √Æn cur√¢nd.");
                    localStorage.removeItem('voted'); // Scoaterea blocajului de vot pentru admin
                    renderAdminContent();
                }
            });
        }

        // *************** INITIALIZARE ***************
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('adminLoginBtn').addEventListener('click', () => {
                document.getElementById('adminModal').style.display = 'block';
            });
            document.getElementById('adminLogoutBtn').addEventListener('click', exitAdminMode);
            
            fetchCurrentData(); // √éncepe preluarea datelor »ôi randarea UI-ului
        });
        
        // *************** SEC»öIUNEA DE DATE ***************
        // C√¢nd se face un commit, codul de salvare insereazƒÉ datele JSON aici.
        
        // *** DATA START ***
{
    "problems": [
        {
            "content": "Problema ini»õialƒÉ de test.",
            "timestamp": 1700000000000
        }
    ],
    "suggestions": [
        {
            "content": "Sugestia ini»õialƒÉ de test.",
            "timestamp": 1700000000000
        }
    ],
    "academics": [
        {
            "content": "Problema academicƒÉ ini»õialƒÉ de test.",
            "timestamp": 1700000000000
        }
    ],
    "bullying": [
        {
            "content": "Raport confiden»õial ini»õial de test.",
            "timestamp": 1700000000000
        }
    ],
    "announcements": [
        {
            "content": "Bine a»õi venit pe Platforma Vocea Elevilor! Testa»õi toate func»õiile.",
            "timestamp": 1700000000000
        }
    ],
    "poll": {
        "question": "DacƒÉ a»õi putea schimba un lucru la »ôcoalƒÉ sƒÉptƒÉm√¢na aceasta, care ar fi acela?",
        "options": [
            "orar",
            "mancare",
            "curatenie"
        ],
        "votes": {
            "orar": 0,
            "mancare": 0,
            "curatenie": 0
        }
    }
}
        // *** DATA END ***
    </script>
</body>
</html>
